name: SQL注入漏洞卡片
title: SQL注入漏洞卡片
severity: 高危漏洞
severity_level: high
threat_level: 高危
cvss_score: 9.8
cvss_vector: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
cve: CWE-89
icon: fa-database
description: 选择不同视角查看SQL注入漏洞的详细信息

perspectives:
  - id: overview
    name: 漏洞概述
    icon: fa-info-circle
    title: 漏洞概述视角
    description: SQL注入的基本概念、原理和影响范围
    content:
      columns:
        - boxes:
            - type: info
              title: 什么是SQL注入？
              icon: fa-question-circle
              content: |
                SQL注入是一种Web安全漏洞，攻击者利用此漏洞可以干扰应用程序对其数据库的查询。通过注入恶意的SQL代码，攻击者可以查看、修改或删除数据库中的数据，甚至执行管理员操作。
            - type: info
              border_color: blue
              title: 漏洞原理
              icon: fa-cogs
              content: |
                当Web应用程序将用户输入直接拼接到SQL查询语句中，而没有进行适当的过滤或转义时，攻击者可以构造特殊的输入，改变原有SQL查询的逻辑。
              code_example: |
                // 易受攻击的代码示例
                $query = "SELECT * FROM users WHERE username = '" . $_POST['username'] . "'";
        - boxes:
            - type: info
              border_color: green
              title: 常见发现位置
              icon: fa-bug
              content:
                type: list
                items:
                  - 用户登录表单
                  - 搜索功能输入框
                  - URL查询参数
                  - HTTP请求头（如Cookie、User-Agent）
                  - 文件上传功能（通过文件名）
                  - API接口参数
            - type: info
              border_color: purple
              title: 受影响数据库
              icon: fa-database
              content:
                type: list
                items:
                  - MySQL / MariaDB
                  - Microsoft SQL Server
                  - Oracle Database
                  - PostgreSQL
                  - SQLite
                  - 其他支持SQL的数据库
      sections:
        - type: attack_flow
          title: 攻击流程
          icon: fa-bolt
          steps:
            - 攻击者提交恶意输入
            - 应用拼接输入到SQL查询
            - 数据库执行被篡改的查询
            - 攻击者获取敏感数据或执行恶意操作
            - 应用返回异常结果给攻击者
        - type: impact
          title: 漏洞影响
          icon: fa-exclamation-triangle
          items:
            - icon: fa-user-secret
              title: 数据泄露
              description: 获取敏感数据，如用户信息、密码哈希等
              color: red
            - icon: fa-edit
              title: 数据篡改
              description: 修改、删除数据库中的数据
              color: blue
            - icon: fa-unlock-alt
              title: 权限绕过
              description: 绕过身份验证机制，获取未授权访问
              color: green
            - icon: fa-server
              title: 系统控制
              description: 在某些情况下，可导致服务器被完全控制
              color: purple

  - id: victim
    name: 受害者视角
    icon: fa-user-shield
    title: 受害者视角
    description: 用户可能遭受的损害及防护建议
    content:
      columns:
        - boxes:
            - type: info
              title: 受害者的体验
              icon: fa-user-injured
              content: |
                作为普通用户或网站管理员，您可能完全不知情的情况下成为SQL注入攻击的受害者。攻击者可能已经窃取了您的个人信息、登录凭证，甚至使用您的账户进行未授权的操作。
            - type: info
              border_color: blue
              title: 如何识别自己是否成为受害者？
              icon: fa-shield-alt
              content:
                type: list
                items:
                  - 收到异常登录通知或发现账户有异常活动
                  - 朋友或同事告知收到来自您账户的异常消息
                  - 发现无法使用正确凭据登录账户
                  - 银行或信用卡账户出现不明交易
                  - 个人信息出现在数据泄露查询网站中
                  - 收到大量垃圾邮件或钓鱼邮件
        - boxes:
            - type: info
              border_color: green
              title: 可能受到的损害
              icon: fa-exclamation-circle
              content:
                type: list
                items:
                  - "个人信息泄露：姓名、地址、电话号码、电子邮件等"
                  - "账户被盗：攻击者使用您的凭据登录您的账户"
                  - "财务损失：如果网站涉及支付功能，可能导致直接经济损失"
                  - "身份盗用：攻击者利用您的个人信息进行欺诈活动"
                  - "隐私侵犯：私人聊天记录、照片等隐私内容被泄露"
                  - "声誉损害：攻击者可能使用您的账户发布不当内容"
      sections:
        - type: impact
          title: 作为用户如何防护？
          icon: fa-user-check
          items:
            - icon: fa-key
              title: 强密码策略
              description: 为不同网站使用不同的强密码，定期更换
              color: red
            - icon: fa-lock
              title: 双因素认证
              description: 启用双因素认证（2FA）增加账户安全性
              color: blue
            - icon: fa-eye
              title: 警惕可疑内容
              description: 警惕可疑的电子邮件、链接和附件
              color: green
            - icon: fa-history
              title: 定期检查
              description: 定期检查账户活动记录和安全设置
              color: purple
        - type: info
          title: 受害者应对措施
          icon: fa-lightbulb
          columns:
            - title: 发现异常后立即：
              content:
                type: list
                items:
                  - 立即更改受影响账户的密码
                  - 启用或更新双因素认证
                  - 检查账户中的安全设置和登录历史
                  - 联系网站管理员报告安全问题
            - title: 长期防护策略：
              content:
                type: list
                items:
                  - 使用密码管理器生成和管理密码
                  - 定期检查HaveIBeenPwned等数据泄露查询网站
                  - 关注网站的安全公告和更新
                  - 对敏感账户使用专用邮箱

  - id: attacker
    name: 攻击者视角
    icon: fa-user-secret
    title: 攻击者视角
    description: 攻击者的目标、方法与常用工具
    content:
      columns:
        - boxes:
            - type: info
              title: 攻击者的目标与方法
              icon: fa-crosshairs
              content: |
                攻击者通常使用自动化工具扫描网站，寻找可能存在SQL注入漏洞的输入点，然后手动验证并利用这些漏洞获取敏感数据或系统控制权。
            - type: info
              border_color: blue
              title: 攻击步骤
              icon: fa-search
              content:
                type: list
                items:
                  - "侦察：识别所有可能的输入点（URL参数、表单字段、HTTP头等）"
                  - "探测：尝试输入特殊字符（如单引号'）观察应用程序反应"
                  - "验证：确认是否存在SQL注入漏洞"
                  - "利用：根据数据库类型构造有效的payload"
                  - "提权：尝试获取更高权限或访问其他数据库"
                  - "渗透：窃取数据或建立持久化访问"
        - boxes:
            - type: info
              border_color: green
              title: 攻击者常用的工具
              icon: fa-tools
              content:
                type: list
                items:
                  - "SQLmap：自动化SQL注入工具，支持多种数据库"
                  - "Burp Suite：Web漏洞扫描和利用工具"
                  - "OWASP ZAP：开源Web应用安全扫描器"
                  - "Havij：自动化SQL注入工具，适合初学者"
                  - "自定义脚本：针对特定目标编写的攻击脚本"
                  - "Nosqlmap：针对NoSQL数据库的注入工具"
            - type: info
              border_color: purple
              title: 攻击目标优先级
              icon: fa-bullseye
              content:
                type: list
                items:
                  - 用户凭证表（用户名、密码哈希）
                  - 个人信息数据库
                  - 支付信息和交易记录
                  - 管理员账户和权限
                  - 系统配置和敏感文件路径
      sections:
        - type: code_examples
          title: 常见攻击Payload示例
          icon: fa-code
          examples:
            - title: 基础的SQL注入测试
              code: |
                ' OR '1'='1

                # 联合查询获取数据
                ' UNION SELECT username, password FROM users--

                # 注释掉后续查询
                admin' --
            - title: 高级注入技术
              code: |
                # 基于时间的盲注
                '; IF (1=1) WAITFOR DELAY '0:0:5'--

                # 基于错误的注入
                ' AND 1=CONVERT(int, (SELECT @@version))--

                # 获取数据库版本
                ' UNION SELECT 1,@@version,3,4 --
        - type: table
          title: SQL注入类型分类
          icon: fa-clipboard-list
          headers:
            - 类型
            - 描述
            - 检测难度
          rows:
            - [经典SQL注入, 直接可见的错误信息或结果, 容易]
            - [盲注, 无错误信息，通过布尔逻辑或时间延迟判断, 中等]
            - [联合查询注入, 使用UNION语句获取其他表数据, 容易]
            - [堆叠查询注入, 执行多个SQL语句，常用于高阶攻击, 中等]
            - [二阶注入, 输入先被存储，之后在另一个查询中被触发, 困难]

  - id: code
    name: 代码触发
    icon: fa-code
    title: 代码触发视角
    description: 易受攻击的代码示例及修复方案
    content:
      columns:
        - boxes:
            - type: info
              title: 易受攻击的代码示例
              icon: fa-exclamation-triangle
              content: |
                下面展示了一段存在SQL注入漏洞的PHP代码：
              code_example: |
                // 从用户输入获取数据
                $username = $_POST['username'];
                $password = $_POST['password'];

                // 直接拼接用户输入到SQL查询中 - 存在SQL注入漏洞！
                $sql = "SELECT * FROM users WHERE username = '$username' AND password = '$password'";

                // 执行查询
                $result = mysqli_query($conn, $sql);
              content_after: |
                攻击示例：
              code_example_2: |
                // 用户名输入：
                admin' -- 

                // 最终执行的SQL查询：
                SELECT * FROM users WHERE username = 'admin' -- AND password = 'xxx'
        - boxes:
            - type: info
              border_color: blue
              title: 修复方案
              icon: fa-wrench
              content: |
                使用参数化查询（预处理语句）：
              code_example: |
                // 使用参数化查询防止SQL注入
                $stmt = $conn->prepare("SELECT * FROM users WHERE username = ? AND password = ?");
                $stmt->bind_param("ss", $username, $password);
                $stmt->execute();
                $result = $stmt->get_result();
              content_after: |
                其他防护措施：
              content_list:
                type: list
                items:
                  - 对所有用户输入进行严格的验证和过滤
                  - 使用ORM框架（如Eloquent、Hibernate）
                  - 实施最小权限原则，数据库用户只拥有必要权限
                  - 对数据库错误信息进行适当处理，避免泄露敏感信息
      sections:
        - type: table
          title: 漏洞检测示例
          icon: fa-vial
          headers:
            - 测试输入
            - 预期结果
            - 漏洞判断
          rows:
            - ["' OR '1'='1", 返回所有用户数据, 存在漏洞]
            - [
                "' AND 1=0 UNION SELECT 1,@@version,3,4 --",
                返回数据库版本信息,
                存在漏洞,
              ]
            - [test123, 正常查询或无结果, 正常]
            - ["admin' AND SLEEP(5) --", 响应延迟5秒, 存在时间盲注]
        - type: impact
          title: 多层防御策略
          icon: fa-shield-alt
          items:
            - icon: fa-check-circle
              title: 输入验证
              description: 白名单验证，限制输入类型和长度
              color: red
            - icon: fa-filter
              title: 参数化查询
              description: 使用预处理语句，分离代码和数据
              color: blue
            - icon: fa-user-lock
              title: 最小权限
              description: 数据库用户只拥有必要的最小权限
              color: green
            - icon: fa-eye-slash
              title: 错误处理
              description: 避免泄露数据库错误信息给用户
              color: purple
        - type: info
          title: 最佳实践总结
          icon: fa-book
          columns:
            - title: 开发阶段：
              content:
                type: list
                items:
                  - 对所有用户输入进行验证和过滤
                  - 始终使用参数化查询或ORM
                  - 实施安全的编码规范
                  - 进行代码安全审计
            - title: 部署阶段：
              content:
                type: list
                items:
                  - 配置Web应用防火墙（WAF）
                  - 定期进行安全测试和渗透测试
                  - 监控异常数据库查询
                  - 保持系统和库的更新

footer_note: 此卡片仅用于教育目的，帮助理解SQL注入漏洞的原理和防护方法。

additional_info:
  cve_url: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CWE-89
  fofa_query: body="mysql" || body="mssql" || body="oracle"
  pocs:
    - name: SQLmap - 自动化 SQL 注入工具
      url: https://github.com/sqlmapproject/sqlmap
      description: 开源的自动化 SQL 注入和数据库接管工具
    - name: NoSQLMap
      url: https://github.com/codingo/NoSQLMap
      description: 针对 NoSQL 数据库的自动化注入工具
  tools:
    - name: SQLmap
      url: https://github.com/sqlmapproject/sqlmap
      description: 最流行的自动化 SQL 注入工具
    - name: jSQL Injection
      url: https://github.com/ron190/jsql-injection
      description: 轻量级的 SQL 注入工具
